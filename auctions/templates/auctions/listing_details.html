{% extends "auctions/layout.html" %} {% block body %}

<div class="container mt-5">
  <div class="row justify-content-center align-items-center">
    <div class="col-sm-5 col-lg-3 d-flex flex-column mr-5">
      <img
        width="250px"
        height="300px"
        src="{{listing.image_url}}"
        alt="{{listing.title}}"
        class="position-relative"
        style="object-fit: contain"
      />
      {% if listing.is_active %} {% if user.is_authenticated %}
      <form class="mt-3" action="{% url 'listing_details' listing.id %}" method="post">
        {% csrf_token %}
        <input type="submit" value="{{watchlist_input}}"</input>
      </form>
      {% if messages %} 
      {% for message in messages %}
        {% if message.tags == 'watchlist_success success' or message.tags == 'watchlist_error error' %}
          <p class="alert {% if message.tags == 'watchlist_success success' %}alert-success
          {% elif message.tags == 'watchlist_error error' %}alert-danger{% endif %}" role="alert">
            {{ message }}
          </p>
        {% endif %}
      {% endfor %}
    {% endif %}

      {% endif %} {% else %}
      <span
        class="badge badge-danger position-absolute top-0 start-50 translate-middle-x"
        style="font-size: 1rem"
        >Closed</span
      >
      {% endif %}
    </div>
    <div class="col-sm-6 col-md-6 d-flex flex-column">
      <h3>{{listing.title}}</h3>
      <p>{{listing.description}}</p>
      <p>Listed by: {{listing.creator}}</p>
      <p>Start bid : {{listing.starting_bid}} $</p>

      {% if listing.start_bid|floatformat < listing.current_bid|floatformat %}
      <p>Current bid : {{listing.current_bid}} $</p>
      {% endif %} {% if user == listing.creator %} {% if listing.is_active %}
      <form action="{% url 'close_listing' listing.id %}" method="post">
        {% csrf_token %}
        <input type="submit" value="Close listing" />
      </form>
      {% else %}
      <span class="alert alert-danger">The listing is closed!</span>
      {% endif %} {% elif user.is_authenticated %}
      <form action="{% url 'add_bid' listing.id %}" method="post">
        {% csrf_token %}
        <div>
          <div class="input-group">
            <div class="input-group-prepend">
              <div class="input-group-text">$</div>
              {{form}}
            </div>
          </div>
        </div>
        <input type="submit" value="Place Bid" class="mt-3" />
        {% if messages %} 
        {% for message in messages %}
          {% if message.tags == 'add_bid_success success' or message.tags == 'add_bid_error error' %}
            <p class="alert {% if message.tags == 'add_bid_success success' %}alert-success{% elif message.tags == 'add_bid_error error' %}alert-danger{% endif %}" role="alert">
              {{ message }}
            </p>
          {% endif %}
        {% endfor %}
      {% endif %}
      </form>
      {% else %}
      <p class="alert alert-primary">
        You must be logged in to bid or add to watchlist.
      </p>
      {% endif %}
    </div>
  </div>
</div>
{% endblock %}
